#include <math.h>
#include "myfunc.h"

//float evalfunc_tpc_fitting(float theta, float *a){
//  float result;
//  result = a[0]*pow(sin(theta), 2) + a[1]*pow(cos(theta), 2)
//    + 2*a[2]*cos(theta)*sin(theta);
//  return result; 
//}

float evalfunc_tpc_fitting(float theta, float **a){
  float result = 0;
  float *x, *y;
  float strp_mean, tclk_mean;
  int n;
  x = a[0];
  y = a[1];
  strp_mean = *a[2];
  tclk_mean = *a[3];
  n = (int)*a[4];
  int i;
  for(i = 0; i < n; i++){
    result += fabs(sin(theta)*x[i] - cos(theta)*y[i] - (sin(theta)*strp_mean - cos(theta)*tclk_mean));
  }
  return result;
}

float evalfunc_tpc_fitting2(float theta, float *a){
  float result;
  result = sin(theta)*sin(theta)*a[0] + cos(theta)*cos(theta)*a[1] -2*sin(theta)*cos(theta)*a[2];
  return result;
}

float mesh_min(float xmin, float xmax, int steps, float (*f)(float, float *), float *x0, float *a){
  float x, minf,xtemp;
  int i;
  for(i = 0; i < steps + 1; i++){
    x = xmin + (xmax - xmin)/steps * i;
    if(i == 1){
      minf = (*f)(x, a);
      xtemp = x;
    }
    else{
      if(minf > (*f)(x, a)){
	minf = (*f)(x, a);
	xtemp = x;
      }
    }
  }
  *x0 = xtemp;
  return minf;
}

int evt_select(int iev){
  int evt_table[] = {282, 301, 932, 1123, 1340, 1349, 2971, 2996, 3112, 3128, 3424, 4164, 4680, 4830, 5565, 5630, 5631, 5986, 6008, 6404, 6447, 6535, 6693, 6846, 7054, 7131, 7381, 7419, 7815, 8594, 8778, 8931, 9031, 9495, 9775, 10011, 10147, 10446, 10935, 11557, 11575, 11763, 11771, 11910, 12467, 13478, 13629, 13762, 13877, 14140, 14199, 14302, 14328, 14348, 14476, 15055, 15247, 15279, 15367, 15718, 16020, 16055, 16149, 16197, 16223, 16754, 18236, 18576, 18625, 18933, 19082, 19643, 19730, 19980, 20300, 20315, 20648, 20687, 21127, 21159, 21207, 21252, 21296, 21598, 21614, 21685, 21903, 21974, 22510, 22565, 22787, 22911, 22942, 23168, 23386, 23737, 23997, 24056, 24234, 24411, 24464, 24501, 24568, 24696, 24712, 25127, 25552, 25635, 25666, 25723, 26145, 26676, 26876, 28000, 28313, 28461, 28628, 28810, 29170, 29202, 29237, 29394, 29516, 29678, 30790, 30808, 30863, 31127, 31238, 31885, 31980, 32631, 32674, 32950, 32980, 33095, 33280, 33443, 33640, 33647, 33891, 33948, 33971, 34127, 34207, 34220, 35001, 35014, 35105, 35395, 35941, 35679, 35685, 35860, 36117, 36179, 36943, 37141, 37700, 37956, 38583, 38784, 39039, 39111, 39238, 39664, 39756, 39927, 40526, 40783, 40182, 41101, 41489, 41971, 42032, 42347, 42602, 42692, 42980, 43312, 43358, 43937, 44008, 45079, 45151, 45408, 46236, 46464, 46794, 46876, 47838, 48156, 48399, 48506, 48545, 48758, 48949, 49777, 49898, 50214, 50496, 50678, 51176, 51443, 51614, 52023, 50298, 52188, 52192, 52400, 52629, 52930, 53181, 53556, 53579, 53767, 53894, 54008, 54139, 54201, 54242, 54339, 54550, 54610, 54636, 54807, 54911, 54951, 54981, 55134, 55329, 55626, 56325, 56753, 57255, 57610, 57671, 57985, 58404, 58441, 59010, 59082, 59400, 59826, 59938, 60132, 60342, 60398, 60859, 61503, 61531, 62408, 62071, 62419, 63562, 63570, 63650, 63691, 64123, 64519, 64619, 65382, 65423, 65546, 65878, 66326, 66340, 66502, 66977, 67973, 68841, 69034, 69061, 69128, 70039, 70398, 70628, 70830, 71107, 71150, 71426, 71504, 71751, 71988, 72370, 73114, 73124, 73144, 73181, 73261, 73296, 73333, 73577, 73630, 73841, 74007, 74265, 74467, 75146, 75277, 75349};

  int i;
  int flag = 0;
  for(i = 0; i < sizeof(evt_table)/sizeof(int); i++){
    if(iev == evt_table[i]){
      flag = 1;
      break;
    }
  }
  return flag;
}
